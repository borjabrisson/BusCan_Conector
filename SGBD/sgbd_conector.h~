/*
 * sgbd_conector.h
 *
 *  Created on: 27/12/2012
 *      Author: Borja
 */

#ifndef SGBD_CONECTOR_H_
#define SGBD_CONECTOR_H_

#include "../configuracion/configuracion.h"

#include <mysql.h>
#include <mysqld_error.h>
#include <map>
#include <iostream>
#include <string>
#include <list>
// #include "translateactionsql.h"
using namespace std;

// ### DATAS!!!

typedef map<string,string> field_type;
typedef struct mystruct{
	string value;
	string tipo;
	bool foreing; // Estas dos se pueden combinar
	string table;
}tep;


class sgbd_conector {
	MYSQL *myData;
	string username;
	string pass;
	string host;
	string db;

	string msgSP; // mesage Store Procedure.
	int port;

	field_type translade(list<string> order,MYSQL_ROW res);
	void setMessage(map<string,string> data);
	map<string,string> resultSP();
	
public:/*
	sgbd_conector();
	~sgbd_conector();*/
	
	sgbd_conector();
	int setCredentials(string user,string pass);
	int conect(string db = "");
	int query(string db, string clause,list<string> order,list<field_type> &record);
	int procedure(string db, string clause);

	string msgLastProcedure();

	bool commit();
	bool rollback();
	
	int modify(string db,string clause,list<string> order);
	int desconect();
};
//	g++ -I/usr/include/mysql -O0 -g3 -Wall -DBIG_JOINS=1  -fno-strict-aliasing  -g -c -fmessage-length=0 -MMD -MP -MF"main.d" -MT"main.d" -L '/usr/lib/i386-linux-gnu' -lmysqlclient -lpthread -lz -lm -lrt -ldl -o "main.o" "main.cpp"
//	g++ -I/usr/include/mysql -O0 -g3 -Wall -DBIG_JOINS=1  -fno-strict-aliasing  -g -c -fmessage-length=0 -MMD -MP -MF"sgbd_conector.d" -MT"sgbd_conector.d" -L '/usr/lib/i386-linux-gnu' -lmysqlclient -lpthread -lz -lm -lrt -ldl -o "sgbd_conector.o" sgbd_conector.cpp
//  g++  -L '/usr/lib/i386-linux-gnu' -lmysqlclient -lpthread -lz -lm -lrt -ldl -o "conector" ./main.o ./sgbd_conector.o
#endif /* SGBD_CONECTOR_H_ */
